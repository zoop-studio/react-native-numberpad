name: Publish and Notify

on:
  push:
    tags:
      - '*'
    branches:
      - feature/github-actions

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

#      - name: Setup Node.js
#        uses: actions/setup-node@v2
#
#      - name: Install dependencies
#        run: yarn install --frozen-lockfile
#
#      - name: Publish to npm
##        run: yarn publish --registry https://registry.npmjs.org/
#        run: echo "NPM_TOKEN is set!"
#        if: env.NODE_AUTH_TOKEN != ''
#        env:
#          NODE_AUTH_TOKEN: ${{secrets.NPM_TOKEN}}

      - name: Branch name
        id: branch_name
        run: |
          echo ::set-output name=SOURCE_NAME::${GITHUB_REF#refs/*/}
          echo ::set-output name=SOURCE_BRANCH::${GITHUB_REF#refs/heads/}
          echo ::set-output name=SOURCE_TAG::${GITHUB_REF#refs/tags/}
        env:
          GITHUB_REF: ${{ github.ref }}

      - name: Build base image
        run: |
          echo $SOURCE_NAME
          echo $SOURCE_BRANCH
          echo $SOURCE_TAG
        env:
          SOURCE_NAME: ${{ steps.branch_name.outputs.SOURCE_NAME }}
          SOURCE_BRANCH: ${{ steps.branch_name.outputs.SOURCE_BRANCH }}
          SOURCE_TAG: ${{ steps.branch_name.outputs.SOURCE_TAG }}

#      - name: Check TAG_NAME
#        run: echo ${{ steps.get_version.outputs.version }}

#      - uses: sarisia/actions-status-discord@v1
#        with:
#          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
#          nodetail: true
#          title: New version of `@zoop.studio/react-native-numberpad` is ready!
#          description: |
#            Version `${{ steps.get_version.outputs.version }}`
#            Click [${{ steps.get_version.outputs.version }}](https://github.com/zoop-studio/react-native-numberpad/tree/${{ steps.get_version.outputs.version }}) to download!
